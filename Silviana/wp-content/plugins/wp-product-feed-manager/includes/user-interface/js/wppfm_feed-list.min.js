/*!
 * feed-list.js v1.1
 * Part of the WP Product Feed Manager
 * Copyright 2017, Michel Jongbloed
 *
 */
"use strict";var $jq=jQuery.noConflict();function wppfm_fillFeedList(){var b=null;var a="";wppfm_getFeedList(function(c){if(c!=="0"){b=JSON.parse(c);a=wppfm_feedListTable(b)}else{a=wppfm_emptyListTable()}$jq("#wppfm-feed-list").empty();$jq("#wppfm-feed-list").append(a)})}function appendCategoryLists(b,c,a){if(a){wppfm_getCategoryListsFromString(b,"",c,function(d){var e=JSON.parse(d)[0];if(e&&e.length>0){$jq("#lvl_0").html(wppfm_categorySelectCntrl(e));$jq("#lvl_0").prop("disabled",false)}else{$jq("#category-selector-lvl").html(wppfm_freeCategoryInputCntrl("default","0",false));$jq("#category-selector-lvl").prop("disabled",false)}})}}function wppfm_resetFeedList(){wppfm_fillFeedList()}function wppfm_resetFeedStatus(a){wppfm_checkNextFeedInQueue(function(b){if("false"!==b&&a.product_feed_id!==b){wppfm_updateFeedRowStatus(b,3)}wppfm_updateFeedRowStatus(a.product_feed_id,parseInt(a.status_id));wppfm_updateFeedRowData(a)})}function wppfm_feedListTable(f){var e="";for(var d=0;d<f.length;d++){var a=f[d]["status"];var b=f[d]["product_feed_id"];var h=f[d]["url"];var c=a==="On hold"||a==="OK"?true:false;var g="";if(c){g=f[d]["products"]}else{if(a==="Processing"){g="Processing the feed, please wait..."}else{if(a==="Failed processing"){g="Processing failed, please try again"}}}e+='<tr id="feed-row"';if(d%2===0){e+=' class="alternate"'}e+=">";e+='<td id="title">'+f[d]["title"]+"</td>";e+='<td id="url">'+h+"</td>";e+='<td id="updated-'+b+'">'+f[d]["updated"]+"</td>";e+='<td id="products-'+b+'">'+g+"</td>";e+='<td id="feed-status-'+b+'" value="'+a+'" style="color: '+f[d]["color"]+'"><strong>';e+=a;e+="</strong></td>";e+='<td id="actions-'+b+'">';if(c){e+=feedReadyActions(b,h,a,f[d]["title"])}else{e+=feedNotReadyActions(b,h,f[d]["title"])}e+="</td>"}return e}function feedReadyActions(c,h,a,f){var e=h==="No feed generated"?false:true;var g=h.lastIndexOf("/")>0?h.slice(h.lastIndexOf("/")-h.length+1):f;var b=a==="OK"?"Deactivated":"Activate";var d='<strong><a href="javascript:void(0);" onclick="parent.location=\'admin.php?page=wp-product-feed-manager-add-new-feed&id='+c+"'\">Edit </a>";d+=e?'| <a href="javascript:void(0);" onclick="wppfm_viewFeed(\''+h+"')\">View </a>":"";d+='| <a href="javascript:void(0);" onclick="wppfm_deleteSpecificFeed('+c+", '"+g+"')\">Delete </a>";d+=e?'| <a href="javascript:void(0);" onclick="wppfm_deactivateFeed('+c+')" id="feed-status-switch-'+c+'">'+b+" </a>":"";d+='| <a href="javascript:void(0);" onclick="wppfm_duplicateFeed('+c+", '"+f+"')\">Duplicate </a></strong>";return d}function feedNotReadyActions(a,e,c){var d=e.lastIndexOf("/")>0?e.slice(e.lastIndexOf("/")-e.length+1):c;var b="<strong>";b+='<a href="javascript:void(0);" onclick="parent.location=\'admin.php?page=wp-product-feed-manager-add-new-feed&id='+a+"'\">Edit </a>";b+='| <a href="javascript:void(0);" onclick="wppfm_deleteSpecificFeed('+a+", '"+d+"')\"> Delete</a>";b+="</strong>";b+=wppfm_addFeedStatusChecker(a);return b}function wppfm_emptyListTable(){var a="";a+="<tr>";a+="<td colspan = 4>No data found</td>";a+="</tr>";return a}function wppfm_updateFeedRowData(c){if(c.status_id==="1"||c.status_id==="2"){var b=c.product_feed_id;var a=c.status_id==="1"?"OK":"Other";$jq("#updated-"+b).html(c.updated);$jq("#products-"+b).html(c.products);$jq("#actions-"+b).html(feedReadyActions(b,c.url,a,c.title))}else{if(c.status_id==="3"){console.log("Row "+b+" now has a status of "+a)}}}function wppfm_updateFeedRowStatus(b,a){switch(a){case 0:$jq("#feed-status-"+b).html("<strong>Unknown</strong>");$jq("#feed-status-"+b).css("color","#6549F7");$jq("#feed-status-switch-"+b).html("");break;case 1:$jq("#feed-status-"+b).html("<strong>OK</strong>");$jq("#feed-status-"+b).css("color","#0073AA");$jq("#feed-status-switch-"+b).html("Deactivate");break;case 2:$jq("#feed-status-"+b).html("<strong>On hold</strong>");$jq("#feed-status-"+b).css("color","#0173AA");$jq("#feed-status-switch-"+b).html("Activate");break;case 3:$jq("#feed-status-"+b).html("<strong>Processing</strong>");$jq("#feed-status-"+b).css("color","#0000FF");$jq("#feed-status-switch-"+b).html("");$jq("#products-"+b).html("Processing the feed, please wait...");break;case 4:$jq("#feed-status-"+b).html("<strong>In processing queue</strong>");$jq("#feed-status-"+b).css("color","#00CCFF");$jq("#feed-status-switch-"+b).html("Activate");break;case 5:$jq("#feed-status-"+b).html("<strong>Has errors</strong>");$jq("#feed-status-"+b).css("color","#FF0000");$jq("#feed-status-switch-"+b).html("Activate");break;case 6:$jq("#feed-status-"+b).html("<strong>Failed processing</strong>");$jq("#feed-status-"+b).css("color","#FF3300");$jq("#feed-status-switch-"+b).html("");break}}jQuery(document).ready(function(){wppfm_resetFeedList()});